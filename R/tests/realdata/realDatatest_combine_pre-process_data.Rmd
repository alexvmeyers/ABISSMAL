---
title: "Test combine and pre-process data functions"
author: "Grace Smith-Vidaurre"
date: "2023-04-20"
output: html_document
---

```{r setup, include=FALSE}

knitr::opts_chunk$set(echo = TRUE)

```

```{r echo = TRUE, eval = TRUE, message = FALSE}

rm(list = ls())

X <- c("tidyverse", "pbapply", "plyr", "dplyr", "data.table", "parallel", "scales", "ggplot2", "knitr", "gridExtra", "grid", "Rmisc", "tidyquant", "ggpubr")

invisible(lapply(X, library, character.only = TRUE))

# install.packages("tidyquant")

# Suppress summarise warnings from dplyr
options(dplyr.summarise.inform = FALSE)

path <- "/media/gsvidaurre/Anodorhynchus/Data_Testing"

#raw_path <- "/home/gsvidaurre/Desktop/MANUSCRIPTS/Prep/ParentalCareTracking_MethodsPaper/raw"

#out_path <- "/home/gsvidaurre/Desktop/MANUSCRIPTS/Prep/ParentalCareTracking_MethodsPaper/analysis_output"

seed <- 401
cores <- parallel::detectCores() - 2

source("/home/gsvidaurre/Desktop/GitHub_repos/Abissmal/R/combine_raw_data_per_sensor.R")
source("/home/gsvidaurre/Desktop/GitHub_repos/Abissmal/R/preprocess_detections.R")

```

Combine these datasets. TKTK I did this at some point for later testing runs while building/testing these functions
```{r}

combine_raw_data_per_sensor(sensors = c("IRBB", "RFID", "Video", "Temp"), tz = "America/New York", POSIXct_format = "%Y-%m-%d %H:%M:%OS", data_path = file.path(path, "Box_01_28March2022/Data"), out_dir = "raw_combined")

```

Pre-process these datasets. TKTK I did this at some point for later testing runs while building/testing these functions
```{r}

preprocess_detections(sensor, detection_col_nm, group_col_nm = NULL, pixel_col_nm = NULL, thin_threshold = NULL, pixel_threshold = NULL, path, data_dir, out_dir, tz, POSIXct_format = "%Y-%m-%d %H:%M:%OS")

```

Then use the pre-processed data to test the integrate_twoSensors function.
```{r}

data_path <- file.path(path, "Box_02_31Dec2022/Data/pre_processed")

rfid_pp <- read.csv(file.path(data_path, "pre_processed_data_RFID.csv")) %>% 
  dplyr::mutate(
    timestamp_ms = as.POSIXct(format(as.POSIXct(timestamp_ms, tz = "America/New York"), "%Y-%m-%d %H:%M:%OS6"))
  )
glimpse(rfid_pp)

video_pp <- read.csv(file.path(data_path, "pre_processed_data_Video.csv")) %>% 
  dplyr::mutate(
    timestamp_ms = as.POSIXct(format(as.POSIXct(timestamp_ms, tz = "America/New York"), "%Y-%m-%d %H:%M:%OS6"))
  )
glimpse(video_pp)

irbb_pp <- read.csv(file.path(data_path, "pre_processed_data_IRBB.csv")) %>% 
  dplyr::mutate(
    timestamp_ms = as.POSIXct(format(as.POSIXct(timestamp_ms, tz = "America/New York"), "%Y-%m-%d %H:%M:%OS6"))
  )
glimpse(irbb_pp)

```

