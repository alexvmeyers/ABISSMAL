---
title: "Vignette 03: Simulate Data"
author: "Grace Smith-Vidaurre"
date: "2023-12-27"
output: html_document
---

```{r setup, include = FALSE}

knitr::opts_chunk$set(echo = TRUE, eval = FALSE)

```

<h2>Vignette Overview and Learning Objectives</h2>

In this third vignette, we will create simulated datasets of animal movements detected by different sensors. Throughout the process of creating these simulated datasets, you will continue to use coding skills that you learned in vignette 02, and you will learn additional skills that include:

1. Creating objects like vectors and data frames
2. Data types
3. Manipulating objects (e.g. adding columns to a data frame)
4. Piping expressions through the tidyverse
5. Writing out data to physical files and reading these files back into R
6. Troubleshooting and fixing errors

<h2>Load packages</h2>

In the previous vignette, you installed a set of data science packages called the `tidyverse`. You also learned about working directories and created a directory on your computer to save data that you generate from this and subsequent vignettes.

Whenever you start a new RMarkdown file or R script, it's important to include code to setup your virtual workspace before starting to write code. In the chunk below, you will clean your global environment and load the tidyverse. This is code that you already saw in vignette 02, but now these lines of code are together in one chunk.
```{r}

rm(list = ls()) # Clean global environment

library(tidyverse) # Load the set of tidyverse packages

```

<h2>Creating a path object</h2>

The next setup step is to specify your working directory. In vignette 02, you used a string (text contained in double quotes to indicate character information) to specify your working directory while using different functions. Using the same long character string over and over is not very efficient, so you can instead save the character string for your working directory inside a new object in R.

You can create the `path` object by writing out the name of the object on the left (without quotes), then the object creation syymbols `<-`, and then the information that you want to store in this object (your working directory as a character string in quotes).
```{r eval = TRUE}

path <- "/home/gsvidaurre/Desktop/ABISSMAL_vignettes"

```

In the code above, you created an object called `path`. You can see contents of the object `path` by writing out the object name and running that code in the console:
```{r eval = TRUE}

path

```

You can also see the contents of `path` by clicking on the "Environment" tab and checking out the column to the right of the object name. `path` is a new object that holds information about your working directory, and it's available in your global environment for future operations.

You can practice removing the `path` object from your global environment by writing and running the code `rm(list = "path")`. After doing this, make sure to recreate `path` using the code above.

<h2>Create timestamps of simulated animal movement detections</h2>

The primary data collected by the ABISSMAL tracking system are timestamps indicating the moment of time when a movement sensor triggered. Many (but not all) of these detections can be attributed to one or more animals moving near a sensor, such as a bird moving through a radio frequency identification (RFID) antenna mounted in the entrance of a nest container. 

In the subsequent code chunks, we will generate simulated data that represent RFID and infrared beam breaker detection datasets. In this simulated example, let's assume that we're collecting data for 2 adult birds at a nest container. The RFID antenna is mounted in the entrance of nest container and 1 pair of infrared beam breakers is mounted in front of the RFID antenna. In this simulated setup, the infrared beam breakers will trigger first when a bird enters the nest container, and the RFID antenna should trigger first when a bird leaves the nest container.

We will start by creating an object that holds simulated timestamps for the RFID antenna. This object is called `rfid_ts`, and it holds 4 timestamps in hours:minutes:seconds format. Each timestamp is surrounded by double quotes to denote that we are using character information here. 

These timestamps are supplied to the function `c()`. This function concatenates values separated by commas into a vector or list object. Above you created an object called `path` without using `c()`, but that object had a single value. Using `c()` allows you to combine multiple values into a vector that will have more than 1 element.
```{r}

# Create a vector of 4 RFID timestamps in HH:MM:SS format
rfid_ts <- c("10:00:00", "10:05:00", "11:00:00", "11:05:00")
  
```

You can check out the different properties of the `rfid_ts` object after it's made.
```{r}

rfid_ts # run the object name to see its contents

is.vector(rfid_ts) # a binary value indicating that rfid_ts is a vector

class(rfid_ts) # a vector with character data

length(rfid_ts) # this vector has 4 elements

```

TKTK continue

* Create a vector of timestamps for the infrared beam breakers. I want to have 2 simulated entrances and 2 simulated exits

* Add in some perching events

* Add in some noise detections

* Then extend the timestamps for each sensor to have 10 - 20 total events of the 3 different types in 1 day

* Then make a spreadsheet per sensor type with metadata

* Write out each spreadsheet

* Iterate over 3 days per sensor type and write out spreadsheets


```{r}
  

# Then create an RFID folder inside this
  if(!dir.exists(file.path(tmp_path, "RFID"))){
    dir.create(file.path(tmp_path, "RFID"))
  }
  
# Generate files of raw RFID data per unique date
dates <- c("2023-8-1", "2023-8-2", "2023-8-3")
  
# Create a vector of RFID timestamps. Each file will have 4 timestamps
event_ts <- c(
  "01:00:00",
  "02:00:00",
  "01:05:00",
  "02:05:00"
)


  # Write out a spreadsheet per date with these timestamps that will be used as input data for the function
  invisible(lapply(1:length(dates), function(i){
    
    sim_ts <- data.frame(timestamp_ms = event_ts) %>% 
      dplyr::mutate(
        chamber_id = "Box_01",
        year = year(dates[i]),
        month = month(dates[i]),
        day = day(dates[i]),
        sensor_id = "RFID",
        PIT_tag_ID = "test"
      )
    
    write.csv(sim_ts, file.path(tmp_path, "RFID", paste("RFID_Box_01_", gsub("-", "_", dates[i]), ".csv", sep = "")), row.names = FALSE)
    
  }))

```

